<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="pl"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>RoomModuleController.kt</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Scheduler</a> &gt; <a href="index.source.html" class="el_package">com.example.scheduler.controller</a> &gt; <span class="el_source">RoomModuleController.kt</span></div><h1>RoomModuleController.kt</h1><pre class="source lang-java linenums">package com.example.scheduler.controller

import com.example.scheduler.controller.exceptions.DuplicatesException
import com.example.scheduler.controller.exceptions.IdenticalObjectExistsException
import com.example.scheduler.controller.observers.AdminTabsObserver
import com.example.scheduler.controller.observers.LocationObserver
import com.example.scheduler.controller.observers.TabsObserver
import com.example.scheduler.models.LocationsModel
import com.example.scheduler.models.RoomsModel
import com.example.scheduler.objects.Room
import com.example.scheduler.utils.*
import io.github.palexdev.materialfx.controls.*
import io.github.palexdev.materialfx.controls.cell.MFXTableRowCell
import io.github.palexdev.materialfx.dialogs.MFXStageDialog
import io.github.palexdev.materialfx.filter.IntegerFilter
import io.github.palexdev.materialfx.filter.StringFilter
import io.github.palexdev.mfxresources.fonts.MFXFontIcon
import javafx.collections.FXCollections
import javafx.fxml.FXML
import javafx.geometry.Insets
import javafx.geometry.Pos
import javafx.scene.layout.VBox
import javafx.scene.paint.Color
import javafx.stage.Stage
import java.sql.SQLException
import java.util.function.Function
import kotlin.Comparator
import kotlin.reflect.KProperty1

/**
 * Klasa kontrolera modułu RoomModule do zarządzania danymi sal
 */
<span class="fc" id="L33">class RoomModuleController: IRoomModuleController, LocationObserver, AdminTabsObserver, TabsObserver {</span>

    /**
     * Przycisk służący do wyświetlania listy sal w wybranej lokalizacji.
     */
    @FXML
    private lateinit var showRoomsButton: MFXButton

    /**
     * Stepper odpowiedzialny za proces dodawania sali wraz z walidacją danych.
     */
    @FXML
<span class="pc bpc" id="L45" title="1 of 2 branches missed.">    lateinit var stepper: MFXStepper</span>

    /**
     * Stepper odpowiedzialny za proces edycji sali wraz z walidacją danych.
     */
<span class="pc" id="L50">    var stepperEdit = MFXStepper()</span>

    /**
     * Tabela służąca do wyświetlania listy sal w wybranej lokalizacji.
     */
    @FXML
<span class="pc bpc" id="L56" title="1 of 2 branches missed.">    lateinit var roomsTableView: MFXTableView&lt;Room&gt;</span>

    /**
     * Kontrolka umożliwiająca wybór lokalizacji do wyświetlenia sal
     */
    @FXML
<span class="pc bpc" id="L62" title="1 of 2 branches missed.">    lateinit var locationChoiceBox: MFXComboBox&lt;String&gt;</span>

    /**
     * Menu kontekstowe wyświetlające się po kliknięciu na wiersz tabeli z salami
     */
<span class="pc bpc" id="L67" title="1 of 2 branches missed.">    lateinit var menu: MFXContextMenu</span>

    /**
     * Flaga informująca o chęci edycji sali.
     */
<span class="pc" id="L72">    var wantToEdit = false</span>

    /**
     * Pomocnicze okno dialogowe do menu kontekstowego.
     */
<span class="nc bnc" id="L77" title="All 2 branches missed.">    lateinit var dialog: MFXStageDialog</span>

    /**
     * Pomocnicze okno dialogowe do wyświetlania wiadomości.
     */
<span class="pc bpc" id="L82" title="1 of 2 branches missed.">    lateinit var dialogMess: MFXStageDialog</span>

    /**
     * Pole tekstowe do wprowadzania nazwy sali podczas dodawania nowej sali
     */
<span class="fc" id="L87">    private var roomNameTextField: MFXTextField = MFXTextField()</span>

    /**
     * Kontrolka umożliwiająca wybór lokalizacji, do której chcemy dodać nową salę
     */
<span class="fc" id="L92">    private var locationStepperChoiceBox: MFXComboBox&lt;String&gt; = MFXComboBox()</span>

    /**
     * Kontrolka umożliwiająca wybór pojemności sali (ile grup) podczas dodawania
     */
<span class="fc" id="L97">    private var volumeChoiceBox: MFXComboBox&lt;Int&gt; = MFXComboBox()</span>

    /**
     * Kontrolka umożliwiająca wybór piętra dla sali podczas dodawania
     */
<span class="fc" id="L102">    private var floorChoiceBox: MFXComboBox&lt;Int&gt; = MFXComboBox()</span>

    /**
     * Pole tekstowe do wprowadzania nazwy sali podczas edycji sali
     */
<span class="fc" id="L107">    private var roomNameTextFieldEdit: MFXTextField = MFXTextField()</span>

    /**
     * Kontrolka umożliwiająca wybór pojemności sali (ile grup) podczas edycji sali
     */
<span class="fc" id="L112">    private var volumeChoiceBoxEdit: MFXComboBox&lt;Int&gt; = MFXComboBox()</span>

    /**
     * Kontrolka umożliwiająca wybór piętra dla sali podczas edycji
     */
<span class="fc" id="L117">    private var floorChoiceBoxEdit: MFXComboBox&lt;Int&gt; = MFXComboBox()</span>

    /**
     * Flaga informująca o tym czy sala jest w trybie edycji
     */
<span class="pc" id="L122">    var inEditMode = false</span>

    /**
     * Flaga informująca o wyświetleniu okna dialogowego z komunikatem.
     */
    private var messageShown = false

    /**
     * Obiekt reprezentujący ostatnio wybraną salę z tabeli
     */
<span class="pc bpc" id="L132" title="1 of 2 branches missed.">    lateinit var lastSelectedRoom: Room</span>

<span class="fc" id="L134">    val roomsModel: RoomsModel = RoomsModel()</span>
<span class="fc" id="L135">    val locationsModel: LocationsModel = LocationsModel()</span>


    /**
     * Inicjalizacja kontrolera
     */
    @FXML
    fun initialize(){
<span class="fc" id="L143">        AdminTabObserver.addObserver(this)</span>
<span class="fc" id="L144">        LocationsModel.addObserver(this)</span>
<span class="fc" id="L145">        TabObserver.addObserver(this)</span>

<span class="fc" id="L147">        setUpUI()</span>
<span class="fc" id="L148">        setOnRoomSelected()</span>
<span class="fc" id="L149">        onLocationsChanged()</span>
<span class="fc" id="L150">        setConstraints(roomNameTextField)</span>
<span class="fc" id="L151">        setConstraints(roomNameTextFieldEdit)</span>

<span class="fc" id="L153">        setActions()</span>

<span class="fc" id="L155">        createSteps(roomNameTextField, locationStepperChoiceBox, volumeChoiceBox, floorChoiceBox, stepper)</span>
<span class="fc" id="L156">        createSteps(roomNameTextFieldEdit, locationStepperChoiceBox, volumeChoiceBoxEdit, floorChoiceBoxEdit, stepperEdit)</span>
<span class="fc" id="L157">    }</span>

    /**
     * Aktualizuje salę w bazie danych.
     *
     * @param roomID      Id edytowanej sali.
     * @param room        sala z nowymi danymi.
     */
    override fun updateRoom(roomID: Int, room: Room) {
<span class="nc" id="L166">        try {</span>
<span class="nc" id="L167">            roomsModel.updateRoom(roomID, room)</span>
<span class="nc" id="L168">            showRooms(room.location)</span>

<span class="nc" id="L170">            MessageUtil.showInfoMessage(</span>
<span class="nc" id="L171">                MessageBundle.getMess(&quot;label.roomUpdated&quot;),</span>
<span class="nc" id="L172">                MessageBundle.getMess(&quot;success.room.correctlyUpdated&quot;),</span>
            )
<span class="nc" id="L174">        }catch (e: SQLException) {</span>
<span class="nc" id="L175">            MessageUtil.showErrorMessage(MessageBundle.getMess(&quot;warning.operationFailed&quot;), MessageBundle.getMess(&quot;warning.updateRoomError&quot;))</span>
        }

<span class="nc" id="L178">    }</span>


    /**
     * Wyświetla listę sal z wybranej lokalizacji w tabeli
     * @param location Lokalizacja, z której sale mają zostać wyświetlone
     */
    override fun showRooms(location: String) {
<span class="fc" id="L186">        roomsTableView.items.clear()</span>
<span class="fc" id="L187">        val rooms = roomsModel.getRooms(location)</span>
<span class="fc" id="L188">        roomsTableView.items = rooms</span>
<span class="pc bpc" id="L189" title="1 of 2 branches missed.">        if (rooms.isEmpty()) MessageUtil.showWarningMessage(MessageBundle.getMess(&quot;warning.noRooms&quot;), MessageBundle.getMess(&quot;warning.noRoomsToShow&quot;))</span>
<span class="fc" id="L190">    }</span>

    /**
     * Obsługuje akcje wywoływane po pierwszym kroku podczas dodawania lub edycji sali.
     *
     * @param roomName      Pole tekstowe do wprowadzania nazwy sali.
     * @param location      Kontrolka wyboru lokalizacji
     * @param stepper       Stepper dodawania lub edycji sali
     */
    override fun handleActionAfterFirstStep(roomName: MFXTextField, location: MFXComboBox&lt;String&gt;, stepper: MFXStepper)
    {
<span class="nc bnc" id="L201" title="All 2 branches missed.">        if (stepper.currentStepperNode == stepper.stepperToggles[1])</span>
        {
<span class="nc bnc" id="L203" title="All 2 branches missed.">            if (this.stepper == stepper)</span>
            {
<span class="nc bnc" id="L205" title="All 6 branches missed.">                if (location.value.isNullOrEmpty())</span>
                {
<span class="nc" id="L207">                    this.stepper.previous()</span>
<span class="nc" id="L208">                    MessageUtil.showWarningMessage(MessageBundle.getMess(&quot;warning.fieldAddingError&quot;), MessageBundle.getMess(&quot;warning.noLocation&quot;))</span>
                }
<span class="nc" id="L210">                else checkDb(location.value, roomName.text, stepper)</span>
            }
<span class="nc" id="L212">            else checkDb(lastSelectedRoom.location, roomName.text, stepper)</span>
        }
<span class="nc" id="L214">    }</span>


    /**
     * Metoda sprawdzająca istnienie podobnych danych podczas dodawania lub edytowania sali
     * @param location Lokalizacja sali
     * @param roomName Nazwa sali
     * @param stepper Obiekt stepper (formularz) dodawania lub edytowania
     */
    fun checkDb(location: String, roomName: String, stepper: MFXStepper)
    {
<span class="fc" id="L225">        try {</span>
<span class="nc bnc" id="L226" title="All 2 branches missed.">            if (this.stepper == stepper) roomsModel.checkDB(location, roomName, inEditMode, messageShown)</span>
<span class="nc" id="L227">            else roomsModel.checkDB(location, roomName, inEditMode, messageShown, lastSelectedRoom)</span>
        }
<span class="fc" id="L229">        catch (e: DuplicatesException)</span>
        {
<span class="fc" id="L231">            stepper.previous()</span>
<span class="fc" id="L232">            MessageUtil.showWarningMessage(MessageBundle.getMess(&quot;warning.roomAddingError&quot;), e.message!!)</span>
        }
<span class="nc" id="L234">        catch (e: IdenticalObjectExistsException)</span>
        {
<span class="nc" id="L236">            showDialogYesNoMessage(e.message!!)</span>
<span class="nc" id="L237">            messageShown = true</span>
<span class="nc bnc" id="L238" title="All 2 branches missed.">            if (!wantToEdit) stepper.previous()</span>
        }
<span class="fc" id="L240">    }</span>


    /**
     * Wykonuje akcje między krokami formularza
     *
     * @param roomName      Pole tekstowe do wprowadzania nazwy sali.
     * @param location      Kontrolka wyboru lokalizacji
     * @param stepper       Stepper dodawania lub edycji sali
     */
    override fun performActionsBetweenSteps(stepper: MFXStepper, roomName: MFXTextField, location: MFXComboBox&lt;String&gt;)
    {
<span class="fc" id="L252">        stepper.addEventHandler(MFXStepper.MFXStepperEvent.NEXT_EVENT) {</span>
<span class="nc" id="L253">            handleActionAfterFirstStep(roomName, location, stepper)</span>
<span class="nc" id="L254">        }</span>
<span class="fc" id="L255">    }</span>


    /**
     * Wyświetla okno dialogowe z przyciskami &quot;Tak&quot; lub &quot;Nie&quot;.
     *
     * @param content Wiadomość do wyświetlenia.
     */
    override fun showDialogYesNoMessage(content: String) {

<span class="pc bpc" id="L265" title="1 of 2 branches missed.">        val stage: Stage = showRoomsButton.scene.window as Stage</span>

<span class="fc" id="L267">        val buttons = listOf(</span>
<span class="pc" id="L268">            MessageBundle.getMess(&quot;label.yes&quot;) to { wantToEdit = true },</span>
<span class="pc" id="L269">            MessageBundle.getMess(&quot;label.no&quot;) to { wantToEdit = false}</span>
        )

<span class="fc" id="L272">        dialogMess = DialogUtils.showMessageDialogWithButtons(content, stage, buttons)</span>
<span class="pc bpc" id="L273" title="1 of 2 branches missed.">        if (dialogMess.owner.isShowing) dialogMess.showAndWait()</span>
<span class="fc" id="L274">    }</span>


    /**
     * Tworzy i konfiguruje tabelę z salami.
     */
    override fun setupTable() {
<span class="fc" id="L281">        val columns = mapOf&lt;MFXTableColumn&lt;Room&gt;, KProperty1&lt;Room, *&gt;&gt;(</span>
<span class="pc" id="L282">            MFXTableColumn(MessageBundle.getMess(&quot;label.roomName&quot;), false, Comparator.comparing(Room::roomName)) to Room::roomName,</span>
<span class="pc" id="L283">            MFXTableColumn(MessageBundle.getMess(&quot;label.volume&quot;), false, Comparator.comparing(Room::volume)) to Room::volume,</span>
<span class="pc" id="L284">            MFXTableColumn(MessageBundle.getMess(&quot;label.floor&quot;), false, Comparator.comparing(Room::floor)) to Room::floor)</span>


<span class="fc" id="L287">        columns.forEach{ column -&gt;</span>
<span class="fc" id="L288">            column.key.rowCellFactory = Function&lt;Room, MFXTableRowCell&lt;Room?, *&gt;&gt;</span>
            {
<span class="nc" id="L290">                val cell = MFXTableRowCell&lt;Room?, Any?&gt;(column.value)</span>
<span class="nc" id="L291">                cell.styleClass.add(&quot;table-cell&quot;)</span>
<span class="nc" id="L292">                cell</span>
            }
<span class="fc" id="L294">        }</span>

<span class="fc" id="L296">        roomsTableView.filters.addAll(</span>
<span class="pc" id="L297">            StringFilter(MessageBundle.getMess(&quot;label.roomName&quot;), Room::roomName),</span>
<span class="pc" id="L298">            IntegerFilter(MessageBundle.getMess(&quot;label.volume&quot;), Room::volume),</span>
<span class="pc" id="L299">            IntegerFilter(MessageBundle.getMess(&quot;label.floor&quot;), Room::floor)</span>
        )

<span class="fc" id="L302">        roomsTableView.tableColumns.addAll(columns.keys)</span>

<span class="fc bfc" id="L304" title="All 2 branches covered.">        for (i in 0 until roomsTableView.tableColumns.size) {</span>
<span class="fc" id="L305">            roomsTableView.tableColumns[i].styleClass.add(&quot;table-header&quot;)</span>
        }

<span class="fc" id="L308">        roomsTableView.tableColumns[1].minWidth = 200.0</span>
<span class="fc" id="L309">        roomsTableView.isFooterVisible = true</span>
<span class="fc" id="L310">    }</span>

    /**
     * Dodaje nową salę do bazy danych
     * @param room     Sala do dodania.
     */
    override fun addRoom(room: Room) {
<span class="fc" id="L317">        try {</span>
<span class="fc" id="L318">            roomsModel.addRoom(room)</span>
<span class="fc" id="L319">            showRooms(room.location)</span>
<span class="fc" id="L320">            MessageUtil.showInfoMessage(MessageBundle.getMess(&quot;label.roomAdded&quot;), MessageBundle.getMess(&quot;success.room.correctlyAdded&quot;))</span>

<span class="nc" id="L322">        }catch (e: SQLException) {</span>
<span class="nc" id="L323">            MessageUtil.showErrorMessage(MessageBundle.getMess(&quot;warning.operationFailed&quot;), MessageBundle.getMess(&quot;warning.addRoomError&quot;))</span>
        }

<span class="fc" id="L326">    }</span>

    /**
     * Usuwa salę z bazy danych
     * @param room sala do usunięcia
     */
    override fun deleteRoom(room: Room) {
<span class="fc" id="L333">        roomsTableView.selectionModel.clearSelection()</span>
<span class="fc" id="L334">        menu.hide()</span>

<span class="pc bpc" id="L336" title="1 of 2 branches missed.">        if (wantToEdit) {</span>
<span class="fc" id="L337">            try {</span>
<span class="fc" id="L338">                roomsModel.deleteRoom(room)</span>
<span class="pc bpc" id="L339" title="1 of 2 branches missed.">                if (roomsTableView.items.size&gt;1) showRooms(room.location) else roomsTableView.items.clear()</span>
<span class="fc" id="L340">                MessageUtil.showInfoMessage(MessageBundle.getMess(&quot;label.operationSucceed&quot;), MessageBundle.getMess(&quot;success.plan.correctlyDeletedRoom&quot;))</span>
<span class="nc" id="L341">            }catch (e: SQLException) {</span>
<span class="nc" id="L342">                MessageUtil.showErrorMessage(MessageBundle.getMess(&quot;warning.operationFailed&quot;), MessageBundle.getMess(&quot;warning.deleteRoomError&quot;))</span>
            }
        }
<span class="fc" id="L345">    }</span>

    /**
     * Wyświetla formularz pozwalający na edycję sali.
     *
     * @param room   Wybrana sala.
     */
    override fun editRoom(room: Room) {

<span class="nc" id="L354">        val vbox = VBox()</span>
<span class="nc" id="L355">        vbox.children.addAll(stepperEdit)</span>

<span class="nc" id="L357">        roomNameTextFieldEdit.text = room.roomName</span>
<span class="nc" id="L358">        floorChoiceBoxEdit.text = room.floor.toString()</span>
<span class="nc" id="L359">        floorChoiceBoxEdit.value = room.floor</span>
<span class="nc" id="L360">        volumeChoiceBoxEdit.value = room.volume</span>
<span class="nc" id="L361">        volumeChoiceBoxEdit.text = room.volume.toString()</span>

<span class="nc" id="L363">        createAndShowDialog(vbox)</span>
<span class="nc" id="L364">    }</span>

    /**
     * Tworzy i wyświetla customowe okno dialogowe.
     *
     * @param vBox Kontener z zawartością okna dialogowego.
     */
    private fun createAndShowDialog(vBox: VBox) {
<span class="nc" id="L372">        vBox.alignment = Pos.CENTER</span>

<span class="nc bnc" id="L374" title="All 2 branches missed.">        val stage: Stage = showRoomsButton.scene.window as Stage</span>
<span class="nc" id="L375">        val shouldBeBigger = vBox.children.contains(stepperEdit)</span>
<span class="nc" id="L376">        dialog = DialogUtils.showCustomDialog(stage, vBox, shouldBeBigger)</span>
        {
<span class="nc" id="L378">            roomsTableView.selectionModel.clearSelection()</span>
<span class="nc" id="L379">            menu.hide()</span>
<span class="nc" id="L380">            messageShown=false</span>
<span class="nc" id="L381">            inEditMode=false</span>

<span class="nc" id="L383">            CommonUtils.removeStepDependencies(stepperEdit, roomNameTextFieldEdit)</span>
<span class="nc" id="L384">            createSteps(roomNameTextFieldEdit, locationStepperChoiceBox, volumeChoiceBoxEdit, floorChoiceBoxEdit, stepperEdit)</span>
<span class="nc" id="L385">        }</span>

<span class="nc" id="L387">        dialog.showAndWait()</span>
<span class="nc" id="L388">    }</span>

    /**
     * Tworzy i wyświetla menu kontekstowe dla wybranej sali z tabeli.
     *
     * @param selectedRowIndex Indeks zaznaczonego wiersza w tabeli.
     * @param selectedItem       Wybrana sala.
     */
    override fun showContextMenu(selectedRowIndex: Int, selectedItem: Room) {

<span class="fc" id="L398">        val deleteButton = MFXContextMenuItem(MessageBundle.getMess(&quot;label.deleteRoom&quot;))</span>
<span class="fc" id="L399">        val editButton = MFXContextMenuItem(MessageBundle.getMess(&quot;label.editRoom&quot;))</span>

<span class="fc" id="L401">        deleteButton.graphic =  MFXFontIcon(&quot;fas-trash-can&quot;, 16.0, Color.BLACK)</span>
<span class="fc" id="L402">        editButton.graphic = MFXFontIcon(&quot;fas-wrench&quot;, 16.0, Color.BLACK)</span>

<span class="fc" id="L404">        deleteButton.setOnAction {</span>
<span class="nc" id="L405">            showDialogYesNoMessage(MessageBundle.getMess(&quot;question.room.askBeforeDelete&quot;))</span>
<span class="nc" id="L406">            deleteRoom(selectedItem)</span>
<span class="nc" id="L407">        }</span>

<span class="fc" id="L409">        editButton.setOnAction {</span>
<span class="nc" id="L410">            inEditMode = true</span>
<span class="nc" id="L411">            editRoom(selectedItem)</span>
<span class="nc" id="L412">        }</span>

<span class="fc" id="L414">        CommonUtils.showContextMenu(selectedRowIndex, roomsTableView, menu, listOf(deleteButton,editButton))</span>
<span class="fc" id="L415">    }</span>

    /**
     * Konfiguruje pierwszy krok formularza dodawania lub edycji sali.
     * @param roomName          Pole tekstowe do wprowadzania nazwy sali.
     * @param locationBox       Kontrolka wyboru lokalizacji
     */
    override fun setUpFirstStepForm(roomName: MFXTextField, locationBox: MFXComboBox&lt;String&gt;)
    {
        //step 1: podaj nazwę sali i lokalizację
<span class="fc" id="L425">        roomName.floatingText = MessageBundle.getMess(&quot;label.enterRoomName&quot;)</span>
<span class="fc" id="L426">        locationBox.floatingText = MessageBundle.getMess(&quot;label.enterLocation&quot;)</span>
<span class="fc" id="L427">        locationBox.items = locationsModel.getLocationsNamesExceptPlatform()</span>
<span class="fc" id="L428">    }</span>

    /**
     * Konfiguruje drugi krok formularza dodawania lub edycji sali.
     * @param volumeBox          Kontrolka wyboru pojemności sali
     * @param floorBox           Kontrolka wyboru piętra
     */
    override fun setUpSecondStepForm(volumeBox: MFXComboBox&lt;Int&gt;, floorBox: MFXComboBox&lt;Int&gt;)
    {
        //step 2: podaj piętro i pojemność
<span class="fc" id="L438">        volumeBox.floatingText = MessageBundle.getMess(&quot;label.enterRoomVolume&quot;)</span>
<span class="fc" id="L439">        floorBox.floatingText = MessageBundle.getMess(&quot;label.enterFloor&quot;)</span>

<span class="fc" id="L441">        volumeBox.items = FXCollections.observableArrayList((1..6).toList())</span>
<span class="fc" id="L442">        floorBox.items = FXCollections.observableArrayList((1..10).toList())</span>
<span class="fc" id="L443">    }</span>

    /**
     *  Konfiguruje formularz dodawania lub edycji sali.
     *  @param roomName       Pole tekstowe do wprowadzania nazwy sali.
     *  @param locationBox    Kontrolka wyboru lokalizacji
     *  @param volumeBox      Kontrolka wyboru pojemności sali
     *  @param floorBox       Kontrolka wyboru piętra
     */
    override fun setupRoomForm(
        roomName: MFXTextField,
        locationBox: MFXComboBox&lt;String&gt;,
        floorBox: MFXComboBox&lt;Int&gt;,
        volumeBox: MFXComboBox&lt;Int&gt;
    ) {
<span class="fc" id="L458">        setUpFirstStepForm(roomName, locationBox)</span>
<span class="fc" id="L459">        setUpSecondStepForm(volumeBox, floorBox)</span>

<span class="fc" id="L461">        CommonUtils.setTextFieldStyle(roomNameTextField, locationStepperChoiceBox, volumeChoiceBox, floorChoiceBox)</span>
<span class="fc" id="L462">        CommonUtils.setTextFieldStyle(roomNameTextFieldEdit, volumeChoiceBoxEdit, floorChoiceBoxEdit)</span>
<span class="fc" id="L463">    }</span>

    /**
     * Ustawia ograniczenia na pola tekstowe walidujące poprawność danych.
     *
     * @param roomName         Pole tekstowe do wprowadzania nazwy lokalizacji.
     */
    override fun setConstraints(roomName: MFXTextField) {
<span class="fc" id="L471">        roomName.validator.constraint(ValidatorUtil.createNotEmptyConstraint(roomName.textProperty(), MessageBundle.getMess(&quot;roomName.validation.notEmpty&quot;)))</span>
<span class="fc" id="L472">        roomName.validator.constraint(ValidatorUtil.createNoLongerThanThirtyLettersConstraint(roomName.textProperty(), MessageBundle.getMess(&quot;roomName.validation.noLongerThan30&quot;) ))</span>
<span class="fc" id="L473">        roomName.validator.constraint(ValidatorUtil.createNoSpecialCharsExceptDigitsConstraint(roomName.textProperty(), MessageBundle.getMess(&quot;roomName.validation.noSpecialChars&quot;)))</span>
<span class="fc" id="L474">    }</span>

    /**
     * Obsługuje akcje wywoływane po kliknięciu na salę w tabeli.
     */
    override fun setOnRoomSelected() {
<span class="fc" id="L480">        CommonUtils.setOnItemSelected(roomsTableView, menu) { selectedRowIndex -&gt;</span>
<span class="nc" id="L481">            lastSelectedRoom = roomsTableView.items[selectedRowIndex]</span>
<span class="nc" id="L482">            showContextMenu(selectedRowIndex,roomsTableView.items[selectedRowIndex])</span>
<span class="nc" id="L483">        }</span>
<span class="fc" id="L484">    }</span>

    /**
     * Metoda wywoływana podczas zmiany tabeli lokalizacji w bazie danych.
     */
    override fun onLocationsChanged() {
<span class="fc" id="L490">        locationChoiceBox.items = locationsModel.getLocationsNamesExceptPlatform()</span>
<span class="fc" id="L491">        locationStepperChoiceBox.items = locationChoiceBox.items</span>
<span class="fc" id="L492">    }</span>

    /**
     * Metoda wywoływana podczas zmiany zakładek przez użytkownika - czyści panel.
     */
    override fun onTabsChanged() {

<span class="nc" id="L499">        locationChoiceBox.clear()</span>
<span class="nc" id="L500">        locationChoiceBox.clearSelection()</span>
<span class="nc" id="L501">        roomsTableView.items.clear()</span>

<span class="nc" id="L503">        CommonUtils.removeStepDependencies(stepper, roomNameTextField)</span>
<span class="nc" id="L504">        createSteps(roomNameTextField, locationStepperChoiceBox, volumeChoiceBox, floorChoiceBox, stepper)</span>
<span class="nc" id="L505">        clearBoxes()</span>
<span class="nc" id="L506">    }</span>

    /**
     * Konfiguruje komponenty GUI
     */
    override fun setUpUI()
    {
<span class="fc" id="L513">        menu = MFXContextMenu(roomsTableView)</span>
<span class="fc" id="L514">        setupRoomForm(roomNameTextField, locationStepperChoiceBox, floorChoiceBox, volumeChoiceBox)</span>
<span class="fc" id="L515">        setupRoomForm(roomNameTextFieldEdit, locationStepperChoiceBox, floorChoiceBoxEdit, volumeChoiceBoxEdit)</span>
<span class="fc" id="L516">        setupTable()</span>
<span class="fc" id="L517">        roomsTableView.prefWidth = 300.0</span>
<span class="fc" id="L518">        stepper.styleClass.add(&quot;stepper&quot;)</span>
<span class="fc" id="L519">        stepperEdit.styleClass.add(&quot;stepper&quot;)</span>
<span class="fc" id="L520">        locationChoiceBox.floatingText = MessageBundle.getMess(&quot;label.chooseLocation&quot;)</span>
<span class="pc bpc" id="L521" title="1 of 2 branches missed.">        showRoomsButton.text = MessageBundle.getMess(&quot;label.showRooms&quot;)</span>
<span class="fc" id="L522">    }</span>

    /**
     * Ustawia akcje na przyciskach
     */
    override fun setActions()
    {
<span class="pc bpc" id="L529" title="1 of 2 branches missed.">        showRoomsButton.setOnAction {</span>
<span class="nc bnc" id="L530" title="All 6 branches missed.">            if(!locationChoiceBox.value.isNullOrBlank()) showRooms(locationChoiceBox.value)</span>
<span class="nc" id="L531">            else MessageUtil.showInfoMessage(MessageBundle.getMess(&quot;warning.showRoomsError&quot;), MessageBundle.getMess(&quot;warning.noLocation&quot;))</span>
<span class="nc" id="L532">        }</span>
<span class="fc" id="L533">    }</span>

    /**
     * Tworzy pierwszy krok formularza dodawania lub edycji sali.
     *
     * @param roomName       Pole tekstowe do wprowadzania nazwy sali.
     * @param stepperr       Stepper dodawania lub edycji sali.
     * @param locationBox    Kontrolka wyboru lokalizacji
     * @return               Pierwszy krok formularza.
     */
    override fun createStep1(roomName: MFXTextField, stepperr: MFXStepper, locationBox: MFXComboBox&lt;String&gt;): MFXStepperToggle {
<span class="fc" id="L544">        val step1 = MFXStepperToggle(&quot;${MessageBundle.getMess(&quot;label.data&quot;)} 1&quot;, MFXFontIcon(&quot;fas-paperclip&quot;, 16.0, Color.web(&quot;#40F6F6&quot;)))</span>

<span class="fc bfc" id="L546" title="All 2 branches covered.">        val step1Box = if(stepperr==stepper) VBox(20.0, ValidationWrapper.wrapNodeForValidationStepper(roomName, stepperr), locationBox) else VBox(10.0, ValidationWrapper.wrapNodeForValidationStepper(roomName, stepperr))</span>
<span class="fc" id="L547">        locationBox.prefWidth = 300.0</span>

<span class="fc" id="L549">        step1Box.alignment = Pos.CENTER</span>
<span class="fc" id="L550">        step1.content = step1Box</span>

<span class="fc" id="L552">        step1.validator.dependsOn(roomName.validator)</span>

<span class="fc" id="L554">        return step1</span>
    }

    /**
     * Tworzy drugi krok formularza dodawania lub edycji sali.
     *
     * @param volumeBox      Kontrolka wyboru pojemności sali.
     * @param floorBox       Kontrolka wyboru piętra /
     * @return               Drugi krok formularza.
     */
    override fun createStep2(volumeBox: MFXComboBox&lt;Int&gt;, floorBox: MFXComboBox&lt;Int&gt;): MFXStepperToggle {
<span class="fc" id="L565">        val step2 = MFXStepperToggle(&quot;${MessageBundle.getMess(&quot;label.data&quot;)} 2&quot;, MFXFontIcon(&quot;fas-pen&quot;, 16.0, Color.web(&quot;#40F6F6&quot;)))</span>
<span class="fc" id="L566">        val step2Box = VBox(30.0, volumeBox, floorBox)</span>
<span class="fc" id="L567">        floorBox.prefWidth = 300.0</span>
<span class="fc" id="L568">        volumeBox.prefWidth = 300.0</span>
<span class="fc" id="L569">        step2Box.alignment = Pos.CENTER</span>
<span class="fc" id="L570">        step2.content = step2Box</span>
<span class="fc" id="L571">        step2Box.padding = Insets(30.0)</span>

<span class="fc" id="L573">        return step2</span>
    }

    /**
     * Tworzy layout informujący o powodzeniu dodania lub edycji nauczyciela
     *  @param roomName       Pole tekstowe do wprowadzania nazwy sali.
     *  @param locationBox    Kontrolka wyboru lokalizacji
     *  @param volumeBox      Kontrolka wyboru pojemności sali
     *  @param floorBox       Kontrolka wyboru piętra
     *  @param stepperr       Stepper dodawania lub edycji sali.
     *  @param step2          Drugi krok formularza.
     */
    override fun createCompletedStep(
        roomName: MFXTextField,
        locationBox: MFXComboBox&lt;String&gt;,
        volumeBox: MFXComboBox&lt;Int&gt;,
        floorBox: MFXComboBox&lt;Int&gt;,
        stepperr: MFXStepper,
        step2: MFXStepperToggle
    ) {
<span class="fc" id="L593">        val completedLabel = CommonUtils.createCompletedLabel(MessageBundle.getMess(&quot;label.roomAdded&quot;))</span>
<span class="fc" id="L594">        val resetButton = CommonUtils.createResetButton()</span>

<span class="fc" id="L596">        resetButton.setOnAction {</span>
<span class="nc" id="L597">            CommonUtils.removeStepDependencies(stepperr, roomName)</span>
<span class="nc" id="L598">            createSteps(roomName, locationBox, volumeBox, floorBox, stepperr)</span>
<span class="nc" id="L599">            clearBoxes()</span>
<span class="nc bnc" id="L600" title="All 2 branches missed.">            if (inEditMode){</span>
<span class="nc" id="L601">                dialog.close()</span>
<span class="nc" id="L602">                inEditMode=false</span>
            }
<span class="nc" id="L604">        }</span>


<span class="fc" id="L607">        stepperr.setOnLastNext {</span>

<span class="nc bnc" id="L609" title="All 4 branches missed.">            if (volumeBox.value!=null &amp;&amp; floorBox.value!=null )</span>
            {
<span class="nc" id="L611">                val room = Room(</span>
<span class="nc" id="L612">                    roomName = roomName.text,</span>
<span class="nc" id="L613">                    volume = volumeBox.value,</span>
<span class="nc" id="L614">                    floor = floorBox.value,</span>
<span class="nc bnc" id="L615" title="All 2 branches missed.">                    location = if (stepperr==stepper) locationBox.value else lastSelectedRoom.location</span>
                )

<span class="nc bnc" id="L618" title="All 2 branches missed.">                if (inEditMode)</span>
                {
<span class="nc" id="L620">                    val roomID = roomsModel.getRoomID(lastSelectedRoom)</span>
<span class="nc" id="L621">                    completedLabel.text = MessageBundle.getMess(&quot;label.roomUpdated&quot;)</span>
<span class="nc" id="L622">                    updateRoom(roomID, room)</span>
                }
                else
                {
<span class="nc" id="L626">                    addRoom(room)</span>
                }

<span class="nc" id="L629">                val vbox = step2.content as VBox</span>
<span class="nc" id="L630">                vbox.children.setAll(completedLabel, resetButton)</span>
            }
            else{
<span class="nc" id="L633">                stepperr.previous()</span>
<span class="nc" id="L634">                MessageUtil.showWarningMessage(MessageBundle.getMess(&quot;warning.fieldAddingError&quot;), MessageBundle.getMess(&quot;warning.floorOrVolumeEmpty&quot;))</span>
            }
<span class="nc" id="L636">        }</span>
<span class="fc" id="L637">    }</span>

    /**
     * Tworzy kroki dla stepper procesu dodawania lub edycji sali.
     *  @param roomName       Pole tekstowe do wprowadzania nazwy sali.
     *  @param locationBox    Kontrolka wyboru lokalizacji
     *  @param volumeBox      Kontrolka wyboru pojemności sali
     *  @param floorBox       Kontrolka wyboru piętra
     *  @param stepperr       Stepper dodawania lub edycji sali.
     */
    override fun createSteps(
        roomName: MFXTextField,
        locationBox: MFXComboBox&lt;String&gt;,
        volumeBox: MFXComboBox&lt;Int&gt;,
        floorBox: MFXComboBox&lt;Int&gt;,
        stepperr: MFXStepper){

<span class="fc" id="L654">        val step1 = createStep1(roomName, stepperr, locationBox)</span>
<span class="fc" id="L655">        val step2 = createStep2(volumeBox, floorBox)</span>
<span class="fc" id="L656">        createCompletedStep(roomName, locationBox, volumeBox, floorBox, stepperr, step2)</span>

<span class="fc" id="L658">        stepperr.stepperToggles.addAll(listOf(step1, step2))</span>
<span class="fc" id="L659">        performActionsBetweenSteps(stepperr, roomName, locationBox)</span>
<span class="fc" id="L660">    }</span>


    /**
     * Czyści pola tekstowe formularza.
     */
    override fun clearBoxes()
    {
<span class="nc" id="L668">        roomNameTextField.clear()</span>
<span class="nc" id="L669">        CommonUtils.clearBox(locationChoiceBox)</span>
<span class="nc" id="L670">        CommonUtils.clearBox(volumeChoiceBox)</span>
<span class="nc" id="L671">        CommonUtils.clearBox(floorChoiceBox)</span>
<span class="nc" id="L672">        CommonUtils.clearBox(locationStepperChoiceBox)</span>
<span class="nc" id="L673">    }</span>


}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.9.202303310957</span></div></body></html>
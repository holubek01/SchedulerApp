<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="pl"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>ClassesToWrite.kt</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Scheduler</a> &gt; <a href="index.source.html" class="el_package">com.example.scheduler.models</a> &gt; <span class="el_source">ClassesToWrite.kt</span></div><h1>ClassesToWrite.kt</h1><pre class="source lang-java linenums">package com.example.scheduler.models

import com.example.scheduler.db.dao.ClassesDAOImpl
import com.example.scheduler.utils.MessageBundle
import javafx.collections.FXCollections
import javafx.collections.ObservableList
import java.sql.SQLException
import java.time.LocalDate

/**
 * Model reprezentujący pojedyńcze zajęcia do zapisu do bazy danych wraz z logiką biznesową.
 *
 * @property date    Data zajęć.
 * @property fieldOfStudy Kierunek kształcenia
 * @property group   Grupa, do której przypisane są zajęcia.
 * @property subject Przedmiot.
 * @property location Lokalizacja (budynek), w której odbywają się zajęcia.
 * @property hour    Zakres godzinowy, w jakim prowadzone są zajęcia.
 * @property room    Nazwa sali, w której odbywają się zajęcia.
 * @property teacher Nauczyciel prowadzący zajęcia.

 */
<span class="fc" id="L23">data class ClassesToWrite(</span>
<span class="fc" id="L24">    var date: LocalDate? = null,</span>
<span class="fc" id="L25">    var fieldOfStudy: String? = null,</span>
<span class="fc" id="L26">    var group: String? = null,</span>
<span class="fc" id="L27">    var subject: String? = null,</span>
<span class="fc" id="L28">    var location: String? = null,</span>
<span class="fc" id="L29">    var hour: String? = null,</span>
<span class="fc" id="L30">    var room: String? = null,</span>
<span class="fc" id="L31">    var teacher: String? = null</span>

    //var date: ObjectProperty&lt;LocalDate&gt; = SimpleObjectProperty(),
    //var fieldOfStudy: StringProperty = SimpleStringProperty(),
)
{
    /**
     * Obiekt zawierajacy zapytania do bazy danych
     */
<span class="fc" id="L40">    private val dao = ClassesDAOImpl()</span>


    /**
     * @see ClassesDAOImpl.canTeacherMoveBetweenClasses
     */
    fun canTeacherMoveBetweenClasses(): Boolean{
<span class="nc" id="L47">        val firstname = teacher!!.split(&quot; &quot;)[1]</span>
<span class="nc" id="L48">        val lastname = teacher!!.split(&quot; &quot;)[0]</span>
<span class="nc bnc" id="L49" title="All 2 branches missed.">        val locationn = if (this.location.equals(MessageBundle.getMess(&quot;label.platform&quot;))) &quot;Platform&quot; else this.location</span>

<span class="nc" id="L51">        return dao.canTeacherMoveBetweenClasses(firstname, lastname, locationn!!, hour!!, date.toString())</span>
    }

    /**
     * @see ClassesDAOImpl.canGroupMoveBetweenClasses
     */
    fun canGroupMoveBetweenClasses(): Boolean{
<span class="pc bpc" id="L58" title="1 of 2 branches missed.">        val locationn = if (this.location.equals(MessageBundle.getMess(&quot;label.platform&quot;))) &quot;Platform&quot; else this.location</span>
<span class="fc" id="L59">        return dao.canGroupMoveBetweenClasses(group!!,fieldOfStudy!!,locationn!!,hour!!,date.toString())</span>
    }

    /**
     * @see ClassesDAOImpl.getGroups
     */
    fun getGroups(): ObservableList&lt;String&gt; {
<span class="fc" id="L66">        return dao.getGroups(fieldOfStudy!!)</span>
    }

    /**
     * @see ClassesDAOImpl.getSubjects
     */
    fun getSubjects(): ObservableList&lt;String&gt;{
<span class="fc" id="L73">        return dao.getSubjects(group!!, fieldOfStudy!!)</span>
    }


    /**
     * @see ClassesDAOImpl.getLocations
     */
    fun getLocations(): ObservableList&lt;String&gt; {
<span class="fc" id="L81">        return FXCollections.observableArrayList(</span>
<span class="fc" id="L82">            dao.getLocations(date!!).map { (it.replace(&quot;Platform&quot;, MessageBundle.getMess(&quot;label.platform&quot;))) })</span>
    }

    /**
     * @see ClassesDAOImpl.getHours
     */
    fun getHours(): ObservableList&lt;String&gt; {
<span class="fc" id="L89">        return dao.getHours(date!!, group!!, fieldOfStudy!!)</span>
    }


    /**
     * @see ClassesDAOImpl.getRooms
     */
    fun getRooms(): ObservableList&lt;String&gt; {
<span class="fc" id="L97">        return dao.getRooms(date!!, hour!!, location!!)</span>
    }

    /**
     * @see ClassesDAOImpl.getTeachers
     */
    fun getTeachers(): ObservableList&lt;String&gt; {
<span class="fc" id="L104">        return dao.getTeachers(date!!, hour!!, subject!!)</span>
    }

    /**
     * @see ClassesDAOImpl.addToPlan
     */
    @Throws(SQLException::class)
    fun addToPlan() {
<span class="fc" id="L112">        val classesToAdd = this.copy()</span>
<span class="pc bpc" id="L113" title="1 of 2 branches missed.">        classesToAdd.location = if (location == MessageBundle.getMess(&quot;label.platform&quot;)) &quot;Platform&quot; else location</span>
<span class="pc bpc" id="L114" title="1 of 2 branches missed.">        classesToAdd.room = if (location == MessageBundle.getMess(&quot;label.platform&quot;)) &quot;Virtual&quot; else room</span>
<span class="fc" id="L115">        dao.addToPlan(classesToAdd)</span>
<span class="fc" id="L116">    }</span>

    /**
     * Tworzy podpowiedź dla użytkownika w przypadku braku nauczycieli do wyboru.
     * @param hours Lista godzin, w jakich grupa jest dostępna w danym dniu
     * @return Lista nauczycieli spełniających warunki i godzin, w których są dostępni
     */
    fun getHoursHint(hours: ObservableList&lt;String&gt;): List&lt;String&gt; {
<span class="fc" id="L124">        val teachersWithHours = dao.getTeacherWithHoursHint(subject!!,date!!)</span>

        //Usuń te godziny, w których grupa jest zajęta
<span class="pc bpc" id="L127" title="1 of 2 branches missed.">        teachersWithHours.removeIf { !hours.contains(it.second) }</span>

<span class="pc bpc" id="L129" title="1 of 2 branches missed.">        val locationn = if (location == MessageBundle.getMess(&quot;label.platform&quot;)) &quot;Platform&quot; else location</span>

        //Usuń nauczycieli, którzy nie zdążą na zajęcia z innej lokalizacji
<span class="pc bpc" id="L132" title="1 of 2 branches missed.">        teachersWithHours.removeIf { !canTeacherMoveBetweenClasses(it.first.split(&quot; &quot;)[1], it.first.split(&quot; &quot;)[0], locationn!!, it.second, date.toString())}</span>
<span class="fc" id="L133">        return teachersWithHours.map { it.second }.distinct()</span>
    }


    /**
     * Tworzy podpowiedź dla użytkownika w przypadku braku nauczycieli do wyboru oraz braku godzin możliwych do zamiany
     * @return Lista zajętych nauczycieli, którzy uczą wybranego przedmiotu i mogliby prowadzić zajęcia gdyby nie byli zajęci
     * a także zdążą zmienić lokalizację jeśli to konieczne.
     */
    fun getBusyTeachersHints(): List&lt;String&gt; {
        //Pobierz nauczycieli, którzy uczą tego przemdiotu ale są w tym czasie zajęci (uproszczona wersja getBusyTeachers())
        //Można wtedy zamienić tego zajętego nauczyciela na wolnego, zajęty nauczyciel stanie się wolnym i będzie można go przypisać do zajęć
<span class="pc bpc" id="L145" title="1 of 2 branches missed.">        val locationn = if (location == MessageBundle.getMess(&quot;label.platform&quot;)) &quot;Platform&quot; else location</span>
<span class="fc" id="L146">        val teachers = dao.getBusyTeachersHint(subject!!,date.toString(),hour!!)</span>

        //Usuń jeśli nauczyciel nie zdążyłby zmienić lokalizacji
<span class="pc bpc" id="L149" title="1 of 2 branches missed.">        teachers.removeIf { !canTeacherMoveBetweenClasses(it.split(&quot; &quot;)[1], it.split(&quot; &quot;)[0], locationn!!, hour!!, date.toString())}</span>
<span class="fc" id="L150">        return teachers</span>
    }

    /**
     * @see ClassesDAOImpl.getFields
     */
    fun getFields(): ObservableList&lt;String&gt; {
<span class="fc" id="L157">        return dao.getFields()</span>
    }

    /**
     * @see ClassesDAOImpl.getHowManyHoursLeft
     */
    fun getHowManyHoursLeft(): Int {
<span class="fc" id="L164">        return dao.getHowManyHoursLeft(group!!,fieldOfStudy!!,subject!!)</span>
    }

    fun canTeacherMoveBetweenClasses(firstname: String, lastname: String, location: String, hour: String, date: String): Boolean{
<span class="fc" id="L168">        return dao.canTeacherMoveBetweenClasses(firstname, lastname, location, hour, date)</span>
    }


    /**
     * Sprawdza, czy przy próbie dodania nowych zajęć do planu użytkownik nie pominął danych.
     *
     * @return Komunikat o błędzie lub null, jeśli nie ma błędów.
     */
    fun getMissingFieldContentIfError(): String? {
<span class="fc" id="L178">        val messContent = when{</span>
<span class="pc bpc" id="L179" title="2 of 4 branches missed.">            date==null || date.toString().isBlank() -&gt; MessageBundle.getMess(&quot;warning.noData&quot;)</span>
<span class="pc bpc" id="L180" title="3 of 6 branches missed.">            fieldOfStudy.isNullOrBlank() -&gt; MessageBundle.getMess(&quot;warning.noField&quot;)</span>
<span class="pc bpc" id="L181" title="3 of 6 branches missed.">            group.isNullOrBlank() -&gt; MessageBundle.getMess(&quot;warning.noGroup&quot;)</span>
<span class="pc bpc" id="L182" title="3 of 6 branches missed.">            subject.isNullOrBlank() -&gt;MessageBundle.getMess(&quot;warning.noSubject&quot;)</span>
<span class="pc bpc" id="L183" title="3 of 6 branches missed.">            location.isNullOrBlank() -&gt;MessageBundle.getMess(&quot;warning.noLocation&quot;)</span>
<span class="pc bpc" id="L184" title="3 of 6 branches missed.">            hour.isNullOrBlank() -&gt; MessageBundle.getMess(&quot;warning.noHour&quot;)</span>
<span class="pc bpc" id="L185" title="3 of 6 branches missed.">            room.isNullOrBlank() -&gt; MessageBundle.getMess(&quot;warning.noRoom&quot;)</span>
<span class="pc bpc" id="L186" title="3 of 6 branches missed.">            teacher.isNullOrBlank() -&gt; MessageBundle.getMess(&quot;warning.noTeacher&quot;)</span>
<span class="fc" id="L187">            else -&gt; null</span>
        }

<span class="fc" id="L190">        return messContent</span>
    }
<span class="fc" id="L192">}</span>
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.9.202303310957</span></div></body></html>
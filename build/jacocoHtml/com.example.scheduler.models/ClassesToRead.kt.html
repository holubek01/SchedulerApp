<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="pl"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>ClassesToRead.kt</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Scheduler</a> &gt; <a href="index.source.html" class="el_package">com.example.scheduler.models</a> &gt; <span class="el_source">ClassesToRead.kt</span></div><h1>ClassesToRead.kt</h1><pre class="source lang-java linenums">package com.example.scheduler.models

import com.example.scheduler.db.dao.ClassesDAOImpl
import com.example.scheduler.utils.MessageBundle
import javafx.collections.ObservableList
import java.sql.SQLException
import java.time.LocalDate

/**
 * Model reprezentujący pojedyńcze zajęcia do odczytu w tabeli wraz z logiką biznesową.
 *
 * @property date    Data zajęć.
 * @property hour    Zakres godzinowy, w jakim prowadzone są zajęcia.
 * @property subject Przedmiot.
 * @property room    Nazwa sali, w której odbywają się zajęcia.
 * @property teacher Nauczyciel prowadzący zajęcia.
 * @property group   Grupa, do której przypisane są zajęcia.
 */
<span class="fc" id="L19">data class ClassesToRead(</span>
<span class="fc" id="L20">    val date: LocalDate,</span>
<span class="fc" id="L21">    val hour: String,</span>
<span class="fc" id="L22">    val subject: String,</span>
<span class="fc" id="L23">    var room: String,</span>
<span class="fc" id="L24">    var teacher: String,</span>
<span class="fc" id="L25">    val group: String</span>
)
{
    /**
     * Obiekt zawierajacy zapytania do bazy danych
     */
<span class="fc" id="L31">    private val dao = ClassesDAOImpl()</span>

    /**
     * Metoda pobierająca tylko godziny, w których wybrana grupa nie ma innych zajęć, nauczyciel zgłosił
     * dyspozycyjność, nie prowadzi w tym czasie innych zajęć oraz
     * nauczyciel i grupa zdążą zmienić lokalizację, jeśli to konieczne
     * @return lista wolnych godzin
     */
    fun getFreeHours(): ObservableList&lt;String&gt; {
<span class="fc" id="L40">        val hours = dao.getFreeHours(this.copy())</span>
<span class="pc bpc" id="L41" title="1 of 2 branches missed.">        val location = if (room.split(&quot;, &quot;)[1] == MessageBundle.getMess(&quot;label.platform&quot;)) &quot;Platform&quot; else room.split(&quot;, &quot;)[1]</span>

<span class="pc bpc" id="L43" title="1 of 2 branches missed.">        hours.removeIf { !canTeacherMoveBetweenClasses(teacher.split(&quot; &quot;)[1], teacher.split(&quot; &quot;)[0], location, it, date.toString()) }</span>
<span class="pc bpc" id="L44" title="1 of 2 branches missed.">        hours.removeIf { !canGroupMoveBetweenClasses(location, it) }</span>
<span class="fc" id="L45">        hours.removeIf { it == hour}</span>
<span class="fc" id="L46">        return hours</span>
    }


    /**
     * @see ClassesDAOImpl.canGroupMoveBetweenClasses
     */
    private fun canGroupMoveBetweenClasses(location: String, h: String): Boolean{
<span class="fc" id="L54">        return dao.canGroupMoveBetweenClasses(group.split(&quot; &quot;)[0], group.split(&quot; &quot;)[1],location,h,date.toString())</span>
    }

    /**
     * @see ClassesDAOImpl.changeHours
     */
    @Throws(SQLException::class)
    fun changeHours(selectedItem: String, value: String) {
<span class="fc" id="L62">        dao.changeHours(selectedItem,value,this.copy())</span>
<span class="fc" id="L63">    }</span>


    /**
     * @see ClassesDAOImpl.changeHoursPlatform
     */
    @Throws(SQLException::class)
    fun changeHoursPlatform(newHour: String) {
<span class="fc" id="L71">        var copyClasses = this.copy()</span>
<span class="pc bpc" id="L72" title="1 of 2 branches missed.">        if (room.contains(MessageBundle.getMess(&quot;label.virtual&quot;))) copyClasses.room = &quot;Virtual, Platform&quot;</span>
<span class="fc" id="L73">        dao.changeHoursPlatform(newHour,copyClasses)</span>
<span class="fc" id="L74">    }</span>

    /**
     * @see ClassesDAOImpl.getFreeRoomsByHour
     */
    fun getFreeRoomsByHour(hour: String): ObservableList&lt;String&gt; {
<span class="fc" id="L80">        return dao.getFreeRoomsByHour(date, hour, room.split(&quot;, &quot;)[1])</span>
    }

    /**
     * @see ClassesDAOImpl.setAnotherRoom
     */
    @Throws(SQLException::class)
    fun setAnotherRoom(selectedItem: String) {
<span class="fc" id="L88">        dao.setAnotherRoom(selectedItem,this.copy())</span>
<span class="fc" id="L89">    }</span>

    /**
     * @see ClassesDAOImpl.changeRooms
     */
    @Throws(SQLException::class)
    fun changeRooms(selectedItem: String) {
<span class="nc" id="L96">        dao.changeRooms(selectedItem,this.copy())</span>
<span class="nc" id="L97">    }</span>

    /**
     * Pobiera sale, które są wolne w terminie zajęć oraz, które znajdują się w lokalizacji, do której
     * zdąży się przemieścić grupa oraz nauczyciel
     *
     * @return lista wolnych sal
     */
    fun getFreeRooms(): ObservableList&lt;String&gt; {
        //Jeśli nie platforma to dodaj platformę (zawsze można zmienić na platformę)
<span class="fc" id="L107">        val locations = dao.getLocationsNames()</span>

        //Wyeliminuj wszystkie lokalizacje, na które nie można zmienić platformy
<span class="pc bpc" id="L110" title="1 of 2 branches missed.">        locations.removeIf { !canGroupMoveBetweenClasses(group.split(&quot;, &quot;)[0], group.split(&quot;, &quot;)[1], it, hour, date.toString())}</span>
<span class="fc bfc" id="L111" title="All 2 branches covered.">        locations.removeIf { !canTeacherMoveBetweenClasses( teacher.split(&quot; &quot;)[1], teacher.split(&quot; &quot;)[0], it, hour, date.toString())}</span>
<span class="fc" id="L112">        val rooms = dao.getFreeRooms(this.copy(),locations)</span>

<span class="pc bpc" id="L114" title="1 of 2 branches missed.">        if (!room.contains(MessageBundle.getMess(&quot;label.virtual&quot;)))</span>
        {
<span class="fc" id="L116">            rooms.add(&quot;${MessageBundle.getMess(&quot;label.virtual&quot;)}, ${MessageBundle.getMess(&quot;label.platform&quot;)}&quot;)</span>
        }

<span class="fc" id="L119">        return rooms</span>
    }

    private fun canGroupMoveBetweenClasses(group: String, location: String, locationToCheck: String, hour: String, date: String): Boolean {
<span class="fc" id="L123">        return dao.canGroupMoveBetweenClasses(group,location,locationToCheck, hour, date)</span>
    }

    /**
     * @see ClassesDAOImpl.getBusyRooms
     */
    fun getBusyRooms(): ObservableList&lt;String&gt; {
<span class="fc" id="L130">        val rooms = dao.getBusyRooms(this.copy())</span>
<span class="fc" id="L131">        rooms.removeIf { it == room }</span>
<span class="fc" id="L132">        return rooms</span>
    }

    /**
     * @see ClassesDAOImpl.setAnotherTeacher
     */
    @Throws(SQLException::class)
    fun setAnotherTeacher(teacher: String, selectedItem: String) {
<span class="fc" id="L140">        return dao.setAnotherTeacher(teacher, selectedItem, this.copy())</span>
    }

    /**
     * @see ClassesDAOImpl.changeTeachers
     */
    @Throws(SQLException::class)
    fun changeTeachers(firstTeacher: String, selectedItem: String) {
<span class="fc" id="L148">        dao.changeTeachers(firstTeacher, selectedItem, this.copy())</span>
<span class="fc" id="L149">    }</span>

    /**
     * @see ClassesDAOImpl.getBusyTeachers
     */
    fun getBusyTeachers(subjects: ObservableList&lt;String&gt;): ObservableList&lt;String&gt; {
<span class="fc" id="L155">        val teachers = dao.getBusyTeachers(subject, date, hour, subjects, room.split(&quot;, &quot;)[1])</span>

        //Proponuje nauczycieli z tej samej lokalizacji, więc nie trzeba sprawdzać czy zdążą dojechać
<span class="fc" id="L158">        teachers.removeIf { it == teacher }</span>
<span class="fc" id="L159">        return teachers</span>

    }

    /**
     * Metoda zwracająca nauczycieli, którzy w terminie zajęć nie mają żadnych zajęć, zgłosili dyspo
     * oraz zdążą zmienić lokalizację jeśli to konieczne
     * @return Lista wolnych nauczycieli, spełniających warunki
     */
    fun getFreeTeachers(): ObservableList&lt;String&gt; {
<span class="fc" id="L169">        val free = dao.getFreeTeachers(subject, date, hour)</span>

        //Usuń z freeTeachers, tych nauczycieli, którzy nie zdążą dotrzeć na zajęcia
<span class="pc bpc" id="L172" title="1 of 2 branches missed.">        val location = if (room.split(&quot;, &quot;)[1] == MessageBundle.getMess(&quot;label.platform&quot;)) &quot;Platform&quot; else room.split(&quot;, &quot;)[1]</span>
<span class="fc" id="L173">        free.removeIf {</span>
<span class="fc bfc" id="L174" title="All 2 branches covered.">            !canTeacherMoveBetweenClasses(it.split(&quot; &quot;)[1], it.split(&quot; &quot;)[0], location, hour, date.toString())</span>
        }

<span class="fc" id="L177">        return free</span>
    }

    /*
    fun getFreeHoursPlatform(): ObservableList&lt;String&gt; {
        val hours = dao.getFreeHours(this.copy())
        hours.removeIf { it == hour}
        return hours
    }

 */


    fun canTeacherMoveBetweenClasses(firstname: String, lastname:String, location: String, hour: String, date: String): Boolean{
<span class="fc" id="L191">        return dao.canTeacherMoveBetweenClasses(firstname, lastname, location, hour, date)</span>
    }

    /**
     * @see ClassesDAOImpl.deleteClasses
     */
    @Throws(SQLException::class)
    fun deleteClasses() {
<span class="fc" id="L199">        dao.deleteClasses(this.copy())</span>
<span class="fc" id="L200">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.9.202303310957</span></div></body></html>